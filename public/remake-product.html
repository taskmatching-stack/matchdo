<!DOCTYPE html>
<!--
  【再製設計表單】分類來自 /admin/remake-categories，AI 必須有參考圖。
  頁面：public/remake-product.html，JS：public/js/remake-product.js
-->
<html lang="zh-TW" data-theme="remake">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>再製設計 - MATCHDO 合做</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Space+Grotesk&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/theme-custom.css" rel="stylesheet">
</head>

<body>
    <!-- 共用前台導覽（由 site-header.js 載入） -->
    <div id="site-header"></div>

    <!-- Supabase Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/config/auth-config.js"></script>
    <script src="/js/auth-middleware.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/site-header.js"></script>


    <style>
        #custom-product { max-width: 1200px; margin: 0 auto; }
        #custom-product .create-panel {
            display: grid;
            grid-template-columns: minmax(320px, 420px) 1fr;
            gap: 2rem;
            align-items: start;
            background: #fff;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 16px rgba(0,0,0,.06);
            border: 1px solid #e5e7eb;
        }
        /* 手機按鈕 + Bottom Sheet：桌機預設隱藏 */
        #catMobileBtn { display: none; }
        .cat-bottom-sheet { display: none; }
        #custom-product .create-panel-left { min-width: 0; }
        #custom-product .create-panel-right {
            min-height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px dashed #cbd5e1;
            padding: 1.5rem;
        }
        #custom-product .create-panel-right { flex-direction: column; align-items: stretch; justify-content: flex-start; overflow-y: auto; }
        #custom-product .create-panel-right.has-result { background: #fff; border-style: solid; border-color: #e5e7eb; }
        #custom-product .create-panel-right.has-result .placeholder-hint { display: none; }
        #custom-product .create-panel-right .placeholder-hint { color: #94a3b8; font-size: 0.9375rem; }
        #custom-product #generatedImagePreview:not(:empty) { margin-bottom: 1rem; }
        #custom-product #pastGeneratedGallery { display: block !important; width: 100%; flex: 1; min-height: 0; }
        #custom-product #pastGeneratedGallery:empty { display: none; }
        #custom-product #generatedImagePreview { flex-shrink: 0; }
        #custom-product .past-gallery-inner,
        #custom-product .past-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.5rem; width: 100%; }
        #custom-product .past-gallery-title { font-size: 0.8125rem; color: #64748b; margin-bottom: 0.5rem; width: 100%; }
        #custom-product .past-gallery .past-item,
        #custom-product .past-gallery-inner .past-item { aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 1px solid #e5e7eb; display: block; }
        #custom-product .past-gallery .past-item img,
        #custom-product .past-gallery-inner .past-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
        #custom-product .past-gallery-inner .past-item-wrap { min-width: 0; display: flex; flex-direction: column; gap: 0.25rem; }
        #custom-product .past-gallery-inner .past-item-caption { font-size: 0.7rem; line-height: 1.2; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100%; }
        /* 歷史圖放大 modal：與首頁媒體牆 lightbox 一致；開啟時背後版面不擠壓 */
        html { scrollbar-gutter: stable; }
        body.modal-open { overflow: hidden; padding-right: 0 !important; margin-right: 0 !important; }
        #pastItemModal { position: fixed; inset: 0; z-index: 1055; overflow-x: hidden; overflow-y: auto; }
        #pastItemModal .modal-dialog { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); margin: 0; max-height: 90vh; }
        #pastItemModal .past-item-modal-dialog { max-width: min(720px, 94vw); max-height: 90vh; margin: 0; }
        #pastItemModal .modal-content { max-height: 90vh; border-radius: 12px; border: none; box-shadow: 0 12px 40px rgba(0,0,0,.2); overflow: hidden; display: flex; flex-direction: column; }
        #pastItemModal .modal-header { padding: 0.75rem 1rem; background: #f0f4f8; border-bottom: 2px solid #445D7E; }
        #pastItemModal .modal-title { font-size: 1rem; font-weight: 600; color: #445D7E; }
        #pastItemModal .modal-body { padding: 0; flex: 1; min-height: 0; overflow-y: auto; background: #f5f7fa; text-align: center; position: relative; display: flex; flex-direction: column; align-items: stretch; }
        #pastItemModal #pastItemModalBody { flex: 1; min-height: 200px; padding: 0.5rem; display: flex; align-items: center; justify-content: center; position: relative; }
        #pastItemModal #pastItemModalBodyInner { width: 100%; height: 100%; min-height: 200px; display: flex; align-items: center; justify-content: center; position: relative; }
        #pastItemModal #pastItemModalBodyInner img { max-width: 100%; max-height: 78vh; width: auto; height: auto; object-fit: contain; border-radius: 8px; }
        #pastItemModal #pastItemModalDetail { position: absolute; left: 0; right: 0; bottom: 0; padding: 0.4rem 0.6rem 0.5rem; background: linear-gradient(transparent, rgba(45,64,89,.95)); color: #fff; text-align: left; font-size: 0.7rem; }
        #pastItemModal #pastItemModalDetail .detail-label { color: rgba(255,255,255,.85); margin-right: 0.25rem; }
        #pastItemModal #pastItemModalDetail .detail-value { color: #fff; margin-bottom: 0.15rem; word-break: break-word; display: inline; }
        #pastItemModal #pastItemModalDetail .detail-row { margin-bottom: 0.15rem; }
        #pastItemModal #pastItemModalDetail .detail-row:last-child { margin-bottom: 0; }
        #pastItemModal #pastItemModalShowSection { padding: 0.5rem 0.75rem; background: #fff; border-top: 1px solid #eee; text-align: left; }
        #pastItemModal .modal-footer { padding: 0.6rem 1rem; background: #fff; border-top: 2px solid rgba(68,93,126,.2); }
        .past-lightbox { position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 1rem; box-sizing: border-box; }
        .past-lightbox-backdrop { position: absolute; inset: 0; background: rgba(45,64,89,.85); cursor: pointer; }
        .past-lightbox-content { position: relative; max-width: 95vw; max-height: 95vh; display: flex; align-items: center; justify-content: center; }
        .past-lightbox-close { position: absolute; top: -2.5rem; right: 0; z-index: 10; width: 2rem; height: 2rem; border: none; background: rgba(255,255,255,.95); color: #445D7E; font-size: 1.5rem; line-height: 1; cursor: pointer; border-radius: 4px; }
        .past-lightbox-close:hover { background: #445D7E; color: #fff; }
        .past-lightbox-image-wrap { position: relative; max-width: 90vw; max-height: 85vh; border-radius: 12px; overflow: hidden; box-shadow: 0 12px 40px rgba(68,93,126,.35); }
        .past-lightbox-image { display: block; max-width: 100%; max-height: 85vh; width: auto; height: auto; vertical-align: middle; }
        .past-lightbox-overlay { position: absolute; left: 0; right: 0; bottom: 0; padding: 1rem 1.25rem; background: linear-gradient(transparent, rgba(45,64,89,.92)); color: #fff; }
        .past-lightbox-prompt { margin: 0 0 0.5rem 0; font-size: 0.9rem; line-height: 1.4; word-break: break-word; }
        .past-lightbox-meta { margin: 0; font-size: 0.8rem; opacity: .95; }
        .past-lightbox-meta span + span { margin-left: 1rem; }
        #custom-product .form-row { display: grid; grid-template-columns: 90px 1fr; gap: 0.75rem 1rem; align-items: center; margin-bottom: 1rem; }
        #custom-product .form-row.full { grid-template-columns: 1fr; }
        #custom-product .form-row .label { font-size: 0.875rem; color: #374151; font-weight: 500; }
        #custom-product .form-row .label span { color: #6b7280; font-weight: 400; }
        #custom-product .prompt-hero {
            width: 100%; min-height: 90px; padding: 0.875rem 1rem;
            border-radius: 10px; border: 1px solid #e5e7eb;
            font-size: 0.9375rem; line-height: 1.5; resize: vertical;
        }
        #custom-product .prompt-hero:focus { border-color: var(--bs-primary); outline: none; box-shadow: 0 0 0 3px rgba(13,148,136,.12); }
        /* 分類：單一區塊、固定高度，不因選項多寡變換大小 */
        #custom-product .cat-tablet {
            display: flex; gap: 0; margin-bottom: 1rem; align-items: stretch;
            border: 1px solid #e5e7eb; border-radius: 10px; overflow: hidden; background: #fff;
        }
        #custom-product .cat-main-panel { flex: 1; min-width: 0; border-right: 1px solid #e5e7eb; }
        #custom-product .cat-sub-panel { flex: 1; min-width: 0; }
        #custom-product .cat-tablet .cat-label {
            font-size: 0.75rem; color: #64748b; font-weight: 500; padding: 0.35rem 0.5rem; background: #f8fafc;
            display: block; border-bottom: 1px solid #e5e7eb;
        }
        #custom-product .cat-sub-panel .cat-label { border-bottom: 1px solid #e5e7eb; }
        #custom-product .cat-tablet .cat-list {
            height: 7.5rem; overflow-y: auto; overflow-x: hidden;
            font-size: 0.875rem; background: #fff;
        }
        #custom-product .cat-tablet .cat-option {
            padding: 0.4rem 0.5rem; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        #custom-product .cat-tablet .cat-option:hover { background: #f1f5f9; }
        #custom-product .cat-tablet .cat-option.selected { background: #e2e8f0; color: #0f172a; }
        #custom-product .cat-sub-panel .cat-list.empty { background: #f8fafc; color: #94a3b8; padding: 0.5rem; display: flex; align-items: center; }
        /* 捲軸 */
        #custom-product .cat-tablet .cat-list::-webkit-scrollbar { width: 6px; }
        #custom-product .cat-tablet .cat-list::-webkit-scrollbar-track { background: #f1f5f9; }
        #custom-product .cat-tablet .cat-list::-webkit-scrollbar-thumb { background: #94a3b8; }
        #custom-product .cat-tablet .cat-list::-webkit-scrollbar-thumb:hover { background: #64748b; }
        #custom-product .cat-tablet .cat-list::-webkit-scrollbar-button { display: none; height: 0; width: 0; }
        #custom-product .cat-tablet .cat-list { scrollbar-width: auto; scrollbar-color: #94a3b8 #f1f5f9; }
        #custom-product .ref-cards-wrap::-webkit-scrollbar { width: 6px; }
        #custom-product .ref-cards-wrap::-webkit-scrollbar-track {
            background: #f1f5f9; margin: 4px 0;
            border-radius: 0 !important; -webkit-border-radius: 0 !important;
        }
        #custom-product .ref-cards-wrap::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,.2); border: none;
            border-radius: 0 !important; -webkit-border-radius: 0 !important;
        }
        #custom-product .ref-cards-wrap::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,.3); }
        #custom-product .ref-cards-wrap::-webkit-scrollbar-button { display: none; height: 0; width: 0; }
        #custom-product .ref-cards-wrap { scrollbar-width: auto; scrollbar-color: rgba(0,0,0,.25) #f1f5f9; }
        #custom-product .file-input-hidden {
            position: absolute; width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; z-index: -1;
        }
        /* 8 個加圖按鈕，無縮圖上方 UI */
        #custom-product .ref-slots { display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.4rem; margin-top: 0.5rem; }
        #custom-product .ref-slot { aspect-ratio: 1; border-radius: 8px; border: 2px dashed #cbd5e1; background: #f8fafc; display: flex; align-items: center; justify-content: center; min-height: 0; overflow: hidden; }
        #custom-product .ref-slot.filled { border-style: solid; border-color: #e5e7eb; padding: 0; }
        #custom-product .ref-slot.filled.selected { border-color: var(--bs-primary, #0d9488); border-width: 3px; box-shadow: 0 0 0 1px var(--bs-primary, #0d9488); }
        #custom-product .ref-slot .ref-slot-add { width: 100%; height: 100%; border: none; background: transparent; color: #64748b; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 0.2rem; }
        #custom-product .ref-slot .ref-slot-add:hover { background: #f1f5f9; color: #475569; }
        #custom-product .ref-slot .ref-slot-thumb { width: 100%; height: 100%; object-fit: cover; display: block; cursor: pointer; }
        #custom-product .ref-slot .ref-slot-clear { position: absolute; top: 2px; right: 2px; width: 20px; height: 20px; border: none; background: rgba(0,0,0,.5); color: #fff; border-radius: 4px; cursor: pointer; font-size: 12px; line-height: 1; padding: 0; }
        #custom-product .ref-slot.filled { position: relative; }
        #custom-product .ref-cards-wrap { margin-top: 0.5rem; max-height: 200px; overflow-y: auto; }
        #custom-product .ref-cards { display: flex; flex-direction: column; gap: 0.4rem; }
        /* 只顯示選中那張的生成選單，點縮圖即切換 */
        #custom-product .ref-cards .ref-card { display: none; }
        #custom-product .ref-cards .ref-card.ref-card-selected { display: flex; }
        #custom-product .ref-card {
            border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.5rem;
            display: flex; align-items: flex-start; gap: 0.5rem; min-height: 0;
        }
        #custom-product .ref-card.ref-card-selected { border-color: var(--bs-primary, #0d9488); background: rgba(13,148,136,.04); }
        #custom-product .ref-card .ref-card-thumb { width: 36px; height: 36px; flex-shrink: 0; object-fit: cover; border-radius: 6px; background: #f3f4f6; }
        #custom-product .ref-card .ref-card-label { display: block; margin-bottom: 0.15rem; }
        #custom-product .ref-card .ref-card-right { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 0.35rem; }
        #custom-product .ref-card .ref-desc { min-height: 36px; padding: 0.3rem; font-size: 0.75rem; border: 1px solid #e5e7eb; border-radius: 6px; resize: vertical; }
        #custom-product .ref-card .btn-describe-one { font-size: 0.75rem; padding: 0.3rem 0.5rem; align-self: flex-start; }
        #custom-product .btn-merge-desc { margin-top: 0.35rem; font-size: 0.8125rem; }
        #custom-product .btn-generate { width: 100%; padding: 0.875rem; font-size: 1rem; font-weight: 600; border-radius: 10px; border: none; margin-top: 1.25rem; }
        #custom-product .page-title { font-size: 1.375rem; font-weight: 700; color: #111; margin-bottom: 0.25rem; }
        #custom-product .page-sub { font-size: 0.875rem; color: #6b7280; margin-bottom: 1.5rem; }
        #custom-product #generatedImagePreview { width: 100%; max-width: 100%; }
        #custom-product #generatedImagePreview .card { border: none; box-shadow: 0 2px 12px rgba(0,0,0,.08); }
        #custom-product #generatedImagePreview img { max-width: 100%; height: auto; display: block; }
        @media (max-width: 768px) {
            .container-fluid.py-4 { padding-top: 0.6rem !important; padding-bottom: 0.6rem !important; }
            #custom-product.py-2 { padding-top: 0 !important; padding-bottom: 0 !important; }
            #custom-product .page-title { display: none; }
            #custom-product .page-sub { display: none; }
            #custom-product .create-panel { grid-template-columns: 1fr; padding: 0.75rem; gap: 0.75rem; }
            /* 結果畫布置頂 */
            #custom-product .create-panel-right {
                order: -1 !important; width: min(55vw, 240px) !important;
                aspect-ratio: 1 !important; min-height: unset !important;
                height: unset !important; margin: 0 auto !important; overflow: hidden !important;
            }
            #custom-product .create-panel-right #pastGeneratedGallery { display: none !important; }
            /* 生成中脈衝 */
            #custom-product .create-panel-right.is-loading {
                background: linear-gradient(90deg, #e8edf3 25%, #cfd8e6 50%, #e8edf3 75%);
                background-size: 300% 100%; animation: canvas-pulse 1.5s ease-in-out infinite;
                border-style: solid; border-color: #445D7E44;
            }
            #custom-product .create-panel-right.is-loading .placeholder-hint { display: none; }
            /* 分類：桌機雙面板隱藏 */
            #custom-product .cat-tablet { display: none !important; }
            /* 手機分類按鈕 */
            #catMobileBtn {
                display: flex; align-items: center; gap: 0.5rem; width: 100%;
                padding: 0.65rem 0.875rem; margin-bottom: 0.5rem;
                background: #fff; border: 1.5px solid #e5e7eb; border-radius: 10px;
                color: #6b7280; font-size: 0.875rem; text-align: left; cursor: pointer;
            }
            #catMobileBtn.has-value { border-color: #445D7E; color: #445D7E; font-weight: 500; }
            /* Bottom Sheet */
            .cat-bottom-sheet {
                display: flex; position: fixed; inset: 0; z-index: 1080;
                flex-direction: column; justify-content: flex-end;
                pointer-events: none; opacity: 0; transition: opacity 0.2s;
            }
            .cat-bottom-sheet.open { pointer-events: auto; opacity: 1; }
            .cat-bs-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.45); }
            .cat-bs-panel {
                position: relative; background: #fff; border-radius: 16px 16px 0 0; max-height: 72vh;
                display: flex; flex-direction: column;
                transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.32,0.72,0,1);
            }
            .cat-bottom-sheet.open .cat-bs-panel { transform: translateY(0); }
            .cat-bs-header { display: flex; align-items: center; padding: 0.75rem 0.875rem; border-bottom: 1px solid #e5e7eb; gap: 0.25rem; }
            .cat-bs-title { flex: 1; font-weight: 600; font-size: 0.9375rem; text-align: center; color: #111; }
            .cat-bs-nav-btn { background: none; border: none; padding: 0.25rem 0.5rem; font-size: 0.875rem; color: #6b7280; cursor: pointer; border-radius: 6px; min-width: 3rem; }
            .cat-bs-nav-btn:active { background: #f3f4f6; }
            .cat-bs-list { overflow-y: auto; flex: 1; min-height: 0; }
            .cat-bs-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.875rem 1rem; font-size: 0.9375rem; color: #374151; border-bottom: 1px solid #f3f4f6; cursor: pointer; }
            .cat-bs-item:active { background: #f1f5f9; }
            .cat-bs-item.is-selected { color: #445D7E; font-weight: 600; }
            .cat-bs-item .cat-bs-check { color: #445D7E; width: 1.1rem; flex-shrink: 0; }
            .cat-bs-item .cat-bs-placeholder-icon { width: 1.1rem; flex-shrink: 0; }
            .cat-bs-item .cat-bs-chevron { margin-left: auto; color: #9ca3af; font-size: 0.75rem; }
            /* 參考圖橫向滾動 */
            #custom-product .ref-slots { display: flex !important; overflow-x: auto; scroll-snap-type: x mandatory; gap: 0.5rem; padding-bottom: 0.35rem; grid-template-columns: unset; }
            #custom-product .ref-slot { flex: 0 0 80px !important; width: 80px !important; height: 80px !important; aspect-ratio: unset !important; scroll-snap-align: start; }
            /* 生成按鈕固定頁底 */
            #custom-product .btn-generate { position: fixed; bottom: 0; left: 0; right: 0; margin: 0; border-radius: 0; z-index: 200; padding: 0.95rem; box-shadow: 0 -2px 12px rgba(0,0,0,0.10); }
            #custom-product .create-panel-left { padding-bottom: 4.5rem; }
            /* Seed 收納 */
            #custom-product details > summary { font-size: 0.8125rem; color: #6b7280; cursor: pointer; list-style: none; display: flex; align-items: center; gap: 0.35rem; }
        }
        @keyframes canvas-pulse { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
    </style>
    <div class="container-fluid py-4" style="background: #f1f5f9;">
        <div class="container">
            <div id="custom-product" class="py-2">
                <h1 class="page-title">再製設計</h1>
                <p class="page-sub">必須上傳至少一張參考圖，選擇再製分類（後台「再製分類」管理）後生成</p>

                <form id="customProductForm">
                    <div class="create-panel">
                        <div class="create-panel-left">
                            <div class="form-row full">
                                <label class="label" for="productPrompt" data-i18n="customProduct.promptLabel">描述你想生成的產品</label>
                                <textarea class="prompt-hero" id="productPrompt" name="productPrompt" rows="3" data-i18n-placeholder="customProduct.promptPlaceholder" placeholder="請輸入風格、材質、結構與顏色"></textarea>
                            </div>

                            <div class="cat-tablet">
                                <div class="cat-main-panel">
                                    <span class="cat-label" data-i18n="customProduct.categoryMain">主分類</span>
                                    <div id="imageCategoryMainList" class="cat-list" role="listbox"></div>
                                    <input type="hidden" id="imageCategoryMainSelect" name="imageCategoryMain" value="">
                                </div>
                                <div class="cat-sub-panel">
                                    <span class="cat-label" data-i18n="customProduct.categorySub">子分類</span>
                                    <div id="imageCategorySubList" class="cat-list empty" role="listbox">請先選左側主分類</div>
                                    <input type="hidden" id="imageCategorySubSelect" name="imageCategorySub" value="">
                                </div>
                            </div>
                            <!-- 手機版分類按鈕 -->
                            <button type="button" id="catMobileBtn" class="cat-mobile-btn" style="display:none;">
                                <i class="bi bi-folder2-open"></i>
                                <span id="catMobileBtnLabel">分類</span>
                                <i class="bi bi-chevron-down ms-auto"></i>
                            </button>

                            <div class="form-row full">
                                <span class="label">參考圖 <span class="text-danger">（再製必填）</span></span>
                                <div id="referenceImagesSlots" class="ref-slots"></div>
                                <input type="file" id="referenceImageFile" accept="image/*" class="file-input-hidden">
                                <div class="ref-cards-wrap">
                                    <div id="referenceImagesCards" class="ref-cards"></div>
                                </div>
                                <button type="button" class="btn btn-outline-secondary btn-sm btn-merge-desc" id="mergeDescriptionsBtn" style="display: none;">將以上描述合併至上方描述框</button>
                            </div>

                            <details id="seedDetails">
                                <summary>進階 Seed 設定</summary>
                                <div class="form-row full mt-2">
                                    <label class="label" for="generationSeed" data-i18n="customProduct.seedLabel">Seed（選填）</label>
                                    <input type="number" id="generationSeed" name="generationSeed" class="form-control" data-i18n-placeholder="customProduct.seedPlaceholder" placeholder="留空＝隨機，整數可重現相同風格" min="-2147483648" max="2147483647" step="1" style="max-width: 12rem;">
                                </div>
                            </details>
                            <button type="button" class="btn btn-primary btn-generate" id="generateImageBtn">
                                <i class="fas fa-wand-magic-sparkles me-2"></i><span data-i18n="customProduct.generate">生成圖片</span>
                            </button>
                        </div>
                        <div class="create-panel-right" id="generatedImagePreviewWrap">
                            <div id="generatedImagePreview"></div>
                            <div id="pastGeneratedGallery" class="past-gallery"></div>
                            <p class="placeholder-hint mb-0" id="generatedImagePlaceholder">生成後的草圖會顯示在這裡</p>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>



    <!-- 手機分類 Bottom Sheet -->
    <div class="cat-bottom-sheet" id="catBottomSheet" aria-modal="true" role="dialog" aria-label="選擇分類">
        <div class="cat-bs-backdrop" id="catBsBackdrop"></div>
        <div class="cat-bs-panel">
            <div class="cat-bs-header">
                <button type="button" class="cat-bs-nav-btn" id="catBsBack" style="visibility:hidden;">&#8592; 返回</button>
                <span class="cat-bs-title" id="catBsTitle">選擇分類</span>
                <button type="button" class="cat-bs-nav-btn" id="catBsClose">關閉</button>
            </div>
            <div class="cat-bs-list" id="catBsList"></div>
        </div>
    </div>

    <!-- 共用前台頁腳（由 site-common.js 載入） -->
    <div id="site-footer"></div>

    <!-- 歷史縮圖點擊：與首頁媒體牆一致 — 大圖、底部疊加提示詞/SEED/帳號、前往連結+關閉 -->
    <div class="modal fade" id="pastItemModal" tabindex="-1" aria-labelledby="pastItemModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered past-item-modal-dialog">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title" id="pastItemModalLabel">生成草圖</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="關閉"></button>
                </div>
                <div class="modal-body p-0 text-center">
                    <div id="pastItemModalBody" style="min-height:120px;">
                        <div id="pastItemModalBodyInner"></div>
                        <div id="pastItemModalDetail">
                            <div class="detail-row"><span class="detail-label">提示詞</span><span id="pastItemModalPrompt" class="detail-value"></span></div>
                            <div class="detail-row"><span class="detail-label">SEED</span><span id="pastItemModalSeed" class="detail-value"></span></div>
                            <div class="detail-row"><span class="detail-label">帳號</span><span id="pastItemModalOwner" class="detail-value"></span></div>
                        </div>
                    </div>
                    <div id="pastItemModalShowSection" class="d-none">
                        <label class="d-flex align-items-center gap-2 mb-0">
                            <input type="checkbox" id="pastItemModalShowOnHomepage" class="form-check-input" disabled>
                            <span class="small">展示在首頁媒體牆</span>
                        </label>
                        <p id="pastItemModalShowOnHomepageHint" class="text-muted small mb-0 mt-1">免費用戶預設展示在首頁，無法取消</p>
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <a id="pastItemModalLink" href="#" class="btn btn-primary btn-sm d-none" target="_blank" rel="noopener">找廠商訂製</a>
                    <button type="button" id="pastItemModalRedesign" class="btn btn-outline-primary btn-sm">再設計</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Back to Top -->
    <a href="#!" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- 歷史圖放大：點縮圖不開新分頁，改開此 modal，圖上疊加提示詞 / Seed / 帳號 -->
    <div id="pastItemLightbox" class="past-lightbox" aria-hidden="true" style="display: none;">
        <div class="past-lightbox-backdrop"></div>
        <div class="past-lightbox-content">
            <button type="button" class="past-lightbox-close" aria-label="關閉">&times;</button>
            <div class="past-lightbox-image-wrap">
                <img id="pastLightboxImage" src="" alt="" class="past-lightbox-image">
                <div class="past-lightbox-overlay">
                    <p class="past-lightbox-prompt" id="pastLightboxPrompt"></p>
                    <p class="past-lightbox-meta"><span id="pastLightboxSeed"></span><span id="pastLightboxAccount"></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/site-common.js"></script>
    <script src="/js/remake-product.js?v=1"></script>
    <script>if (window.i18n && window.i18n.ready) { window.i18n.ready.then(function () { if (window.i18n.applyPage) window.i18n.applyPage(); var t = window.i18n.t; if (t && t('remakeProduct.pageTitle') !== 'remakeProduct.pageTitle') document.title = t('remakeProduct.pageTitle'); }); }</script>
</body>

</html>
