<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥åˆå§‹åŒ–å±…å®¶å­åˆ†é¡æ¬„ä½</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background: #f5f5f5; }
        .container { max-width: 1000px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        #log { max-height: 500px; overflow-y: auto; font-family: monospace; font-size: 13px; background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 4px; }
        .log-success { color: #4ec9b0; }
        .log-error { color: #f48771; }
        .log-info { color: #569cd6; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4">ğŸš€ ç›´æ¥åˆå§‹åŒ–å±…å®¶å­åˆ†é¡æ¬„ä½ï¼ˆå‰ç«¯ç‰ˆï¼‰</h2>
        <div class="alert alert-warning">
            <strong>æ³¨æ„ï¼š</strong>æ­¤é é¢å°‡èª¿ç”¨å¾Œç«¯ API æ›´æ–°è³‡æ–™åº«ä¸­æ‰€æœ‰ã€Œå±…å®¶ã€å­åˆ†é¡çš„ form_config æ¬„ä½ã€‚
        </div>
        
        <button id="initBtn" class="btn btn-lg btn-primary mb-4" onclick="directInit()">
            ç«‹å³åˆå§‹åŒ–
        </button>
        
        <div id="log" class="mb-3"></div>
        
        <div id="summary" class="alert alert-info" style="display:none;">
            <h5>åŸ·è¡Œæ‘˜è¦</h5>
            <p class="mb-0" id="summaryText"></p>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const className = `log-${type}`;
            logDiv.innerHTML += `<div class="${className}">[${new Date().toLocaleTimeString()}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function directInit() {
            const btn = document.getElementById('initBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>åˆå§‹åŒ–ä¸­...';
            
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';
            
            log('é–‹å§‹åˆå§‹åŒ–...', 'info');
            log('å‘¼å«å¾Œç«¯ API...', 'info');
            
            try {
                const response = await fetch('/api/subcategories/force-init-home', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log(`API å›æ‡‰æˆåŠŸï¼`, 'success');
                    log(`ç¸½æ•¸: ${result.total}, æˆåŠŸ: ${result.success_count}`, 'success');
                    
                    if (result.results && Array.isArray(result.results)) {
                        result.results.forEach((r, i) => {
                            if (r.status === 'SUCCESS') {
                                log(`âœ… [${i+1}] ${r.key}: å·²æ›´æ–° ${r.fields_count} å€‹æ¬„ä½`, 'success');
                            } else if (r.status === 'NOT_FOUND') {
                                log(`âš ï¸ [${i+1}] ${r.key}: ${r.message}`, 'error');
                            } else if (r.status === 'ERROR') {
                                log(`âŒ [${i+1}] ${r.key}: ${r.message}`, 'error');
                            }
                        });
                    }
                    
                    document.getElementById('summary').style.display = 'block';
                    document.getElementById('summaryText').innerHTML = `
                        æˆåŠŸæ›´æ–° <strong>${result.success_count}</strong> å€‹å­åˆ†é¡<br>
                        å¤±æ•— <strong>${result.total - result.success_count}</strong> å€‹å­åˆ†é¡
                    `;
                } else {
                    log(`âŒ API å›æ‡‰å¤±æ•—: ${result.error || result.message}`, 'error');
                }
            } catch (e) {
                log(`âŒ å‘¼å« API æ™‚ç™¼ç”ŸéŒ¯èª¤: ${e.message}`, 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = 'é‡æ–°åˆå§‹åŒ–';
        }
    </script>
</body>
</html>
