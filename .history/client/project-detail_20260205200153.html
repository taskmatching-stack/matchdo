<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <title>å°ˆæ¡ˆè©³æƒ… - MatchDO åˆåš</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Favicon -->
    <link href="/iStudio-1.0.0/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Space+Grotesk&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/iStudio-1.0.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/iStudio-1.0.0/css/style.css" rel="stylesheet">

    <!-- Supabase Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/config/auth-config.js"></script>
    <script src="/js/auth-middleware.js"></script>
    <script src="/iStudio-1.0.0/js/site-header.js"></script>
</head>

<body>
    <!-- å…±ç”¨å‰å°å°è¦½ -->
    <div id="site-header"></div>

    <!-- Page Header Start -->
    <div class="container-fluid bg-primary py-2">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="text-white mb-0">å°ˆæ¡ˆè©³æƒ…</h3>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent mb-0">
                        <li class="breadcrumb-item"><a class="text-white" href="/iStudio-1.0.0/index.html">é¦–é </a></li>
                        <li class="breadcrumb-item"><a class="text-white" href="dashboard.html">æ§åˆ¶å°</a></li>
                        <li class="breadcrumb-item"><a class="text-white" href="my-projects.html">æˆ‘çš„å°ˆæ¡ˆ</a></li>
                        <li class="breadcrumb-item text-white active">å°ˆæ¡ˆè©³æƒ…</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
    <!-- Page Header End -->

    <!-- Project Detail Start -->
    <div class="container-xxl py-3">
        <div class="container">
            <!-- è¼‰å…¥ä¸­ -->
            <div id="loadingSection" class="text-center py-5">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
                <p class="mt-3 text-muted">è¼‰å…¥å°ˆæ¡ˆè³‡æ–™ä¸­...</p>
            </div>

            <!-- éŒ¯èª¤è¨Šæ¯ -->
            <div id="errorSection" class="d-none">
                <div class="text-center py-5">
                    <i class="fas fa-exclamation-circle fa-4x text-warning mb-4"></i>
                    <h4 class="mb-3" id="errorMessage">è¼‰å…¥å¤±æ•—</h4>
                    <p class="text-muted mb-4">è«‹ç¢ºèªå°ˆæ¡ˆ ID æ˜¯å¦æ­£ç¢ºï¼Œæˆ–å¾å°ˆæ¡ˆåˆ—è¡¨é¸æ“‡è¦æŸ¥çœ‹çš„å°ˆæ¡ˆ</p>
                    <div class="d-flex gap-2 justify-content-center">
                        <a href="/client/my-projects.html" class="btn btn-primary">
                            <i class="fas fa-list me-2"></i>è¿”å›å°ˆæ¡ˆåˆ—è¡¨
                        </a>
                        <a href="/iStudio-1.0.0/index.html#ai-estimate" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>å»ºç«‹æ–°å°ˆæ¡ˆ
                        </a>
                    </div>
                </div>
            </div>

            <!-- å°ˆæ¡ˆå…§å®¹ -->
            <div id="projectContent" class="d-none">
                <!-- å°ˆæ¡ˆåŸºæœ¬è³‡è¨Š -->
                <div class="row mb-4">
                    <!-- å°ˆæ¡ˆå°é¢åœ–ç‰‡ -->
                    <div class="col-lg-4 mb-3">
                        <div class="card border-0 shadow-sm">
                            <img id="projectCoverImage" src="" class="card-img-top" alt="å°ˆæ¡ˆå°é¢" style="height: 300px; object-fit: cover;">
                            <div class="card-body">
                                <h6 class="mb-2">å°é¢åœ–ç‰‡</h6>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="uploadCoverImage()">
                                        <i class="fas fa-upload me-1"></i>ä¸Šå‚³ç…§ç‰‡
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="generateAICoverImage()">
                                        <i class="fas fa-magic me-1"></i>AI ç”Ÿæˆï¼ˆ20 é»ï¼‰
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="useDefaultImage()">
                                        <i class="fas fa-undo me-1"></i>ä½¿ç”¨é è¨­åœ–
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h2 class="mb-0" id="projectTitle">å°ˆæ¡ˆåç¨±</h2>
                                    <span id="projectStatus" class="badge bg-primary">é€²è¡Œä¸­</span>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-tag me-2"></i>
                                            ä¸»åˆ†é¡ï¼š<span id="projectCategory">å±…å®¶</span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-calendar me-2"></i>
                                            å»ºç«‹æ™‚é–“ï¼š<span id="projectCreated">2026-02-05</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <h5 class="mb-2">å°ˆæ¡ˆæè¿°</h5>
                                    <p id="projectDescription" class="text-muted">å°ˆæ¡ˆæè¿°è¼‰å…¥ä¸­...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                <h5 class="mb-3">å¿«é€Ÿæ“ä½œ</h5>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" onclick="editProject()">
                                        <i class="fas fa-edit me-2"></i>ç·¨è¼¯å°ˆæ¡ˆ
                                    </button>
                                    <button class="btn btn-success" onclick="manageItems()">
                                        <i class="fas fa-tasks me-2"></i>ç®¡ç†åˆ†åŒ…é …ç›®
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="deleteProject()">
                                        <i class="fas fa-trash me-2"></i>åˆªé™¤å°ˆæ¡ˆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†åŒ…é …ç›®èˆ‡çµ±åŒ…çµ„åˆ -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="mb-0">
                                        <i class="fas fa-boxes me-2 text-primary"></i>
                                        åˆ†åŒ…é …ç›®ç®¡ç†
                                    </h4>
                                    <button class="btn btn-primary btn-sm" onclick="addNewItem()">
                                        <i class="fas fa-plus me-1"></i>æ–°å¢é …ç›®
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-4">
                                <!-- çµ±åŒ…çµ„åˆ -->
                                <div id="packageGroupsSection">
                                    <h5 class="mb-3">
                                        <i class="fas fa-layer-group me-2"></i>çµ±åŒ…çµ„åˆ
                                    </h5>
                                    <div id="packageGroupsList">
                                        <p class="text-muted text-center py-3">å°šæœªå»ºç«‹çµ±åŒ…çµ„åˆ</p>
                                    </div>
                                </div>

                                <hr class="my-4">

                                <!-- å–®ç¨åˆ†åŒ…é …ç›® -->
                                <div id="singleItemsSection">
                                    <h5 class="mb-3">
                                        <i class="fas fa-cube me-2"></i>å–®ç¨åˆ†åŒ…é …ç›®
                                    </h5>
                                    <div id="singleItemsList">
                                        <p class="text-muted text-center py-3">å°šæœªå»ºç«‹åˆ†åŒ…é …ç›®</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åª’åˆå°ˆå®¶åˆ—è¡¨ -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-white py-3">
                                <h4 class="mb-0">
                                    <i class="fas fa-user-tie me-2 text-success"></i>
                                    åª’åˆå°ˆå®¶åˆ—è¡¨
                                </h4>
                            </div>
                            <div class="card-body p-4">
                                <div id="matchedExpertsList">
                                    <p class="text-muted text-center py-5">
                                        <i class="fas fa-info-circle fa-3x mb-3 d-block"></i>
                                        å°šæœªé–‹å§‹åª’åˆï¼Œæˆ–æš«ç„¡ç¬¦åˆçš„å°ˆå®¶
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Project Detail End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/iStudio-1.0.0/lib/wow/wow.min.js"></script>
    <script src="/iStudio-1.0.0/lib/easing/easing.min.js"></script>
    <script src="/iStudio-1.0.0/lib/waypoints/waypoints.min.js"></script>
    <script src="/iStudio-1.0.0/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/iStudio-1.0.0/lib/isotope/isotope.pkgd.min.js"></script>
    <script src="/iStudio-1.0.0/lib/lightbox/js/lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="/iStudio-1.0.0/js/main.js"></script>
    <script src="/iStudio-1.0.0/js/site-header.js"></script>
    
    <!-- Category Default Images -->
    <script src="/config/category-default-images.js"></script>

    <!-- Project Detail Script -->
    <script>
        let currentUser = null;
        let projectId = null;
        let projectData = null;

        // å¾ URL å–å¾—å°ˆæ¡ˆ ID
        function getProjectIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('=== Project Detail åˆå§‹åŒ–é–‹å§‹ ===');

                // æª¢æŸ¥ç™»å…¥
                if (!window.AuthService) {
                    console.error('âŒ AuthService æœªè¼‰å…¥ï¼');
                    window.location.href = '/login.html';
                    return;
                }

                currentUser = await AuthService.getCurrentUser();
                if (!currentUser) {
                    console.warn('âš ï¸ ç”¨æˆ¶æœªç™»å…¥');
                    window.location.href = '/login.html';
                    return;
                }

                // å–å¾—å°ˆæ¡ˆ ID
                projectId = getProjectIdFromUrl();
                if (!projectId) {
                    showError('ç¼ºå°‘å°ˆæ¡ˆ ID');
                    return;
                }

                console.log('âœ… è¼‰å…¥å°ˆæ¡ˆ:', projectId);

                // è¼‰å…¥å°ˆæ¡ˆè³‡æ–™
                await loadProjectData();
                await loadProjectItems();
                await loadMatchedExperts();

                console.log('=== Project Detail åˆå§‹åŒ–å®Œæˆ ===');
            } catch (error) {
                console.error('ğŸ’¥ åˆå§‹åŒ–å¤±æ•—:', error);
                showError(error.message);
            }
        });

        // è¼‰å…¥å°ˆæ¡ˆè³‡æ–™
        async function loadProjectData() {
            try {
                const { data, error } = await AuthService.supabase
                    .from('projects')
                    .select('*')
                    .eq('id', projectId)
                    .eq('owner_id', currentUser.id)
                    .single();

                if (error) throw error;
                if (!data) throw new Error('å°ˆæ¡ˆä¸å­˜åœ¨æˆ–ç„¡æ¬Šé™æŸ¥çœ‹');

                projectData = data;

                // é¡¯ç¤ºå°ˆæ¡ˆè³‡è¨Š
                document.getElementById('projectTitle').textContent = data.title || 'æœªå‘½åå°ˆæ¡ˆ';
                document.getElementById('projectDescription').textContent = data.description || 'ç„¡æè¿°';
                document.getElementById('projectCreated').textContent = new Date(data.created_at).toLocaleDateString('zh-TW');
                
                // ç‹€æ…‹æ¨™ç±¤
                const statusBadge = document.getElementById('projectStatus');
                const statusMap = {
                    'open': { text: 'é€²è¡Œä¸­', class: 'bg-primary' },
                    'in_progress': { text: 'æ–½å·¥ä¸­', class: 'bg-warning' },
                    'completed': { text: 'å·²å®Œæˆ', class: 'bg-success' },
                    'cancelled': { text: 'å·²å–æ¶ˆ', class: 'bg-secondary' }
                };
                const status = statusMap[data.status] || { text: 'æœªçŸ¥', class: 'bg-secondary' };
                statusBadge.textContent = status.text;
                statusBadge.className = `badge ${status.class}`;

                // é¡¯ç¤ºå…§å®¹å€
                document.getElementById('loadingSection').classList.add('d-none');
                document.getElementById('projectContent').classList.remove('d-none');

            } catch (error) {
                console.error('âŒ è¼‰å…¥å°ˆæ¡ˆå¤±æ•—:', error);
                throw error;
            }
        }

        // è¼‰å…¥åˆ†åŒ…é …ç›®
        async function loadProjectItems() {
            try {
                const { data: items, error } = await AuthService.supabase
                    .from('project_items')
                    .select('*')
                    .eq('project_id', projectId)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!items || items.length === 0) {
                    return; // ä¿æŒé è¨­çš„ã€Œå°šæœªå»ºç«‹ã€è¨Šæ¯
                }

                // åˆ†çµ„ï¼šçµ±åŒ…çµ„ vs å–®ç¨é …ç›®
                const packageGroups = {};
                const singleItems = [];

                items.forEach(item => {
                    if (item.is_bundled && item.package_group_id) {
                        if (!packageGroups[item.package_group_id]) {
                            packageGroups[item.package_group_id] = {
                                name: item.package_group || 'æœªå‘½åçµ„åˆ',
                                items: []
                            };
                        }
                        packageGroups[item.package_group_id].items.push(item);
                    } else {
                        singleItems.push(item);
                    }
                });

                // é¡¯ç¤ºçµ±åŒ…çµ„åˆ
                renderPackageGroups(packageGroups);

                // é¡¯ç¤ºå–®ç¨é …ç›®
                renderSingleItems(singleItems);

            } catch (error) {
                console.error('âŒ è¼‰å…¥åˆ†åŒ…é …ç›®å¤±æ•—:', error);
            }
        }

        // æ¸²æŸ“çµ±åŒ…çµ„åˆ
        function renderPackageGroups(groups) {
            const container = document.getElementById('packageGroupsList');
            
            if (Object.keys(groups).length === 0) {
                container.innerHTML = '<p class="text-muted text-center py-3">å°šæœªå»ºç«‹çµ±åŒ…çµ„åˆ</p>';
                return;
            }

            let html = '';
            Object.entries(groups).forEach(([groupId, group]) => {
                html += `
                    <div class="card mb-3 border-success">
                        <div class="card-header bg-success bg-opacity-10">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="fas fa-box-open me-2 text-success"></i>
                                    ${group.name} (${group.items.length} å€‹é …ç›®)
                                </h6>
                                <button class="btn btn-sm btn-outline-danger" onclick="ungroupPackage('${groupId}')">
                                    <i class="fas fa-unlink me-1"></i>è§£æ•£
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                ${group.items.map(item => `
                                    <div class="list-group-item px-0">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1">${item.item_name}</h6>
                                                <small class="text-muted">
                                                    <i class="fas fa-tag me-1"></i>${item.category_name || 'æœªåˆ†é¡'}
                                                </small>
                                            </div>
                                            <span class="badge bg-${getStatusColor(item.status)}">${getStatusText(item.status)}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ¸²æŸ“å–®ç¨é …ç›®
        function renderSingleItems(items) {
            const container = document.getElementById('singleItemsList');

            if (items.length === 0) {
                container.innerHTML = '<p class="text-muted text-center py-3">å°šæœªå»ºç«‹å–®ç¨åˆ†åŒ…é …ç›®</p>';
                return;
            }

            const html = items.map(item => `
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${item.item_name}</h6>
                                <small class="text-muted">
                                    <i class="fas fa-tag me-1"></i>${item.category_name || 'æœªåˆ†é¡'}
                                </small>
                            </div>
                            <div>
                                <span class="badge bg-${getStatusColor(item.status)} me-2">${getStatusText(item.status)}</span>
                                <button class="btn btn-sm btn-outline-primary" onclick="editItem('${item.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // è¼‰å…¥åª’åˆå°ˆå®¶
        async function loadMatchedExperts() {
            try {
                const { data: matches, error } = await AuthService.supabase
                    .from('matches')
                    .select(`
                        *,
                        expert:expert_id (
                            id,
                            email,
                            user_metadata
                        ),
                        listing:listing_id (
                            id,
                            title,
                            description
                        )
                    `)
                    .eq('project_id', projectId)
                    .eq('status', 'active')
                    .order('score', { ascending: false });

                if (error) throw error;

                if (!matches || matches.length === 0) {
                    return; // ä¿æŒé è¨­è¨Šæ¯
                }

                // æ¸²æŸ“å°ˆå®¶åˆ—è¡¨
                renderMatchedExperts(matches);

            } catch (error) {
                console.error('âŒ è¼‰å…¥åª’åˆå°ˆå®¶å¤±æ•—:', error);
            }
        }

        // æ¸²æŸ“åª’åˆå°ˆå®¶
        function renderMatchedExperts(matches) {
            const container = document.getElementById('matchedExpertsList');

            const html = matches.map(match => {
                const expert = match.expert;
                const listing = match.listing;
                const score = Math.round(match.score || 0);

                return `
                    <div class="card mb-3 border-primary">
                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="mb-2">
                                        <i class="fas fa-user-circle me-2 text-primary"></i>
                                        ${expert?.user_metadata?.full_name || expert?.email || 'æœªçŸ¥å°ˆå®¶'}
                                    </h5>
                                    <p class="text-muted mb-2">${listing?.title || 'æœªå‘½åæœå‹™'}</p>
                                    <p class="mb-3">${listing?.description || ''}</p>
                                    
                                    <!-- åª’åˆåˆ†æ•¸ -->
                                    <div class="mb-3">
                                        <span class="me-3">
                                            <i class="fas fa-star text-warning me-1"></i>
                                            åª’åˆåˆ†æ•¸ï¼š<strong>${score} åˆ†</strong>
                                        </span>
                                    </div>

                                    <!-- è¯çµ¡æ–¹å¼ï¼ˆåª’åˆæˆåŠŸç›´æ¥é¡¯ç¤ºï¼‰ -->
                                    <div class="alert alert-info mb-0">
                                        <h6 class="mb-2">
                                            <i class="fas fa-phone me-2"></i>è¯çµ¡æ–¹å¼
                                        </h6>
                                        <p class="mb-1" id="contact-${match.id}">
                                            <span class="spinner-border spinner-border-sm me-2"></span>
                                            è¼‰å…¥è¯çµ¡è³‡è¨Šä¸­...
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: ${score}%">
                                            ${score}%
                                        </div>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="contactExpert('${expert.id}')">
                                        <i class="fas fa-envelope me-2"></i>ç«‹å³è¯ç¹«
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;

            // è¼‰å…¥æ¯å€‹å°ˆå®¶çš„è¯çµ¡æ–¹å¼
            matches.forEach(match => {
                if (match.expert?.id) {
                    loadContactInfo(match.expert.id, match.id);
                }
            });
        }

        // è¼‰å…¥è¯çµ¡è³‡è¨Šï¼ˆåª’åˆæˆåŠŸç›´æ¥é¡¯ç¤ºï¼Œç„¡éœ€è§£é–ï¼‰
        async function loadContactInfo(expertId, matchId) {
            try {
                const { data, error } = await AuthService.supabase
                    .from('contact_info')
                    .select('*')
                    .eq('user_id', expertId)
                    .single();

                if (error) throw error;

                const container = document.getElementById(`contact-${matchId}`);
                
                if (!data) {
                    container.innerHTML = '<small class="text-muted">è©²å°ˆå®¶å°šæœªå¡«å¯«è¯çµ¡è³‡è¨Š</small>';
                    return;
                }

                // çµ„åˆè¯çµ¡è³‡è¨Š
                const contacts = [];
                if (data.phone) contacts.push(`<i class="fas fa-phone me-1"></i>${data.phone}`);
                if (data.mobile) contacts.push(`<i class="fas fa-mobile me-1"></i>${data.mobile}`);
                if (data.line_id) contacts.push(`<i class="fab fa-line me-1"></i>${data.line_id}`);
                if (data.email) contacts.push(`<i class="fas fa-envelope me-1"></i>${data.email}`);

                if (contacts.length === 0) {
                    container.innerHTML = '<small class="text-muted">è©²å°ˆå®¶å°šæœªå¡«å¯«è¯çµ¡è³‡è¨Š</small>';
                } else {
                    container.innerHTML = contacts.map(c => `<div class="mb-1">${c}</div>`).join('');
                }

            } catch (error) {
                console.error('âŒ è¼‰å…¥è¯çµ¡è³‡è¨Šå¤±æ•—:', error);
                const container = document.getElementById(`contact-${matchId}`);
                container.innerHTML = '<small class="text-danger">è¼‰å…¥å¤±æ•—</small>';
            }
        }

        // å·¥å…·å‡½æ•¸
        function getStatusColor(status) {
            const colors = {
                'draft': 'secondary',
                'published': 'primary',
                'matched': 'success',
                'assigned': 'info',
                'in_progress': 'warning',
                'completed': 'success',
                'cancelled': 'danger'
            };
            return colors[status] || 'secondary';
        }

        function getStatusText(status) {
            const texts = {
                'draft': 'è‰ç¨¿',
                'published': 'å·²ç™¼åŒ…',
                'matched': 'å·²åª’åˆ',
                'assigned': 'å·²æŒ‡æ´¾',
                'in_progress': 'é€²è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'cancelled': 'å·²å–æ¶ˆ'
            };
            return texts[status] || 'æœªçŸ¥';
        }

        function showError(message) {
            document.getElementById('loadingSection').classList.add('d-none');
            document.getElementById('errorSection').classList.remove('d-none');
            document.getElementById('errorMessage').textContent = message;
        }

        // æ“ä½œå‡½æ•¸ï¼ˆæš«æ™‚è·³è½‰æˆ–æç¤ºï¼‰
        function editProject() {
            alert('ç·¨è¼¯å°ˆæ¡ˆåŠŸèƒ½é–‹ç™¼ä¸­');
        }

        function manageItems() {
            window.location.href = `project-items.html?id=${projectId}`;
        }

        function deleteProject() {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å°ˆæ¡ˆå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                alert('åˆªé™¤åŠŸèƒ½é–‹ç™¼ä¸­');
            }
        }

        function addNewItem() {
            window.location.href = `project-items.html?id=${projectId}&action=new`;
        }

        function editItem(itemId) {
            alert(`ç·¨è¼¯é …ç›® ${itemId} åŠŸèƒ½é–‹ç™¼ä¸­`);
        }

        function ungroupPackage(groupId) {
            if (confirm('ç¢ºå®šè¦è§£æ•£æ­¤çµ±åŒ…çµ„åˆå—ï¼Ÿé …ç›®å°‡è®Šç‚ºå–®ç¨åˆ†åŒ…ã€‚')) {
                alert('è§£æ•£çµ±åŒ…åŠŸèƒ½é–‹ç™¼ä¸­');
            }
        }

        function contactExpert(expertId) {
            alert(`è¯ç¹«å°ˆå®¶ ${expertId} åŠŸèƒ½é–‹ç™¼ä¸­ï¼ˆå¯é–‹å•Ÿå°è©±è¦–çª—æˆ–è·³è½‰åˆ°è¨Šæ¯é é¢ï¼‰`);
        }
    </script>
</body>

</html>
