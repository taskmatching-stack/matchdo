# MatchDO「合做」落地 TODO 清單（分階段）

更新日期：2026-02-04

### 今日更新（Delta）
- [x] 新增 `ai_categories` 資料表與初始種子（請在 Supabase SQL Editor 執行新增段落）。
- [x] 新增後台頁面：`public/admin/categories.html`（可編輯 key/名稱/提示詞/子分類）。
- [x] 新增 API：`GET /api/categories`、`PUT /api/categories`（前台載入、後台儲存）。
- [x] 前台改為優先從 API 載入分類，API 失敗時回退使用 `js/ai-categories.js`。
- [x] 導覽列新增「後台：分類管理」入口（首頁右側）。

後續建議：
- [ ] 後台頁面加上登入保護（Supabase Auth），避免匿名修改。
- [ ] 將 `js/ai-categories.js` 移除或改為純備援，避免雙重來源混淆。
- [ ] 新增基本審計紀錄（誰在何時修改了哪些分類）。

## Phase 1 (MVP) — 介面＋Auth＋Schema
- [ ] 以現有 Bootstrap 靜態頁為基礎，新增「發案者端／專家端／後台」導覽入口（標示 MatchDO「合做」）。
- [ ] 導入 Supabase 專案，建立 `.env` 並接 Supabase JS SDK（Auth）。
- [ ] 建置 `users`、`experts_profile`、`listings`、`projects` 之基本資料表（含索引）。
- [ ] 完成註冊／登入頁與導航保護（未登入不可進入管理頁）。
- [ ] 規劃前端檔案結構（`public/` 保持；新增 `assets/js/` 模組化）。
- [ ] 在專家端新增「報價上架」表單（品名、價格、備註）。
- [ ] 在發案者端新增「圖片上傳」表單，將檔案存至 Supabase Storage。

## Phase 2 (AI Core) — Edge Functions 串 Gemini
- [ ] 建立 Edge Function：`generate-listing-tags`（輸入品名／價格 → 回傳 5 個隱藏 Tags）。
- [ ] 建立 Edge Function：`extract-project-specs`（輸入 image_url → 3 個工項 × 每項 3 個規格 Tags）。
- [ ] 於前端串呼 Edge Functions，讓上架／上傳後能顯示 AI 結果並寫入 DB。
- [ ] 設計基本錯誤處理：AI 失敗時允許人工補充／重試。

## Phase 3 (Matching) — SQL 邏輯與排名
- [ ] 寫 PostgreSQL 函數／檢視：計算 `tags_overlap_count` + 價格適配度（範圍可調）。
- [ ] 建立 `matches` 表，保存比對結果（含 score、price_fit、created_at）。
- [ ] 在發案者端顯示候選廠商清單（按分數排序）。
- [ ] 在專家端顯示被媒合的專案與狀態。
- [ ] 加入「合做」按鈕 → 觸發解鎖聯繫（建立對話）。

## Phase 4 (Business) — 金流與期限
- [ ] 串 Stripe 或綠界：會員訂閱（月費）與單次刊登費。
- [ ] 建立 `payment-webhook` Edge Function，驗證與更新 `payments`／`listings` 狀態。
- [ ] 刊登期限：90 天到期通知／續期；定時任務掃描並標記 `expired`。
- [ ] 後台審核入口：專家身分審核、檢舉處理、熱門工項統計報表。

## 機能與前端細節
- [ ] 任務牆（專家端）：顯示 AI 媒合中的項目＋歷史「合做」紀錄。
- [ ] 私訊對話：建立 `conversations`，可使用 Supabase Realtime（channels）。
- [ ] 隱私控管：未解鎖前遮蔽廠商聯絡資訊；解鎖後僅雙方可見。
- [ ] 風控：建立檢舉入口與後台標記流程（`admin_flags`）。
- [ ] UI 文案校正：全站以「MatchDO 合做」為準（非「合作」）。

## 開發環境與建置
- [ ] 新增 `README.md`（專案啟動、環境變數、部署流程）。
- [ ] 規劃打包工具（建議 Vite + ES Modules；先以原生 JS 落地再逐步升級）。
- [ ] 撰寫最小單元測試（Edge Functions）與 SQL 檢視驗證。

## 里程碑核對與驗證
- [ ] P1 完成標準：註冊／登入可用、能上架報價與上傳圖片、DB 寫入成功。
- [ ] P2 完成標準：AI 拆圖與隱藏 Tags 正常、JSON 結構落地。
- [ ] P3 完成標準：媒合 SQL 正確、候選清單排序合理、可合做並開啟對話。
- [ ] P4 完成標準：金流入帳、webhook 驗證成功、刊登期限管理可用。
