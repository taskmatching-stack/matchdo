# 媒體牆三類型 50 : 30 : 20 實作說明

更新：2026-02-06

---

## 一、比例與角色（依你提供的策略）

| 類型 | 比例 | 角色 | 視覺 | 資料來源（現況） |
|------|------|------|------|------------------|
| **用戶設計圖** | **50%** | 靈感、SEO、社群轉發 | 單圖，1×1 小格 | ✅ `custom_products`（有 `show_on_homepage`） |
| **廠商作品對比圖** | **30%** | 信任、實品感 | 前後對比 Slider，1×1 小格 | ⚠️ `manufacturer_portfolio`（有 `image_url` + `image_url_before`，**尚無「可上媒體牆」欄位**） |
| **系列產品資料夾** | **20%** | 專業、高客單 | 資料夾縮圖，**2×2 大格** | ❌ **目前沒有對應表與 API**，需新建 |

- 總格數建議：例如一頁 **20 格** → 用戶設計 10 格、對比圖 6 格、資料夾 4 格（2 張 2×2 大卡）。
- 資料夾用 **2×2** 可讓 20% 在視覺上仍很突出。

---

## 二、現有程式與缺什麼

### 1. 用戶設計圖（50%）— 已有

- **表**：`custom_products`，欄位 `show_on_homepage`、`ai_generated_image_url`。
- **API**：`GET /api/custom-products/for-homepage`（分頁）。
- **前端**：首頁只顯示這一種，格子 1×1。
- **要改**：之後併入「混合媒體牆 API」，並依 50% 比例取數。

### 2. 廠商作品對比圖（30%）— 差「上牆開關」與 API

- **表**：`manufacturer_portfolio`  
  - `image_url`：主圖（實品）  
  - `image_url_before`：對比圖（概念/前）  
  - 可做「拖拉 Slider」前後對比。
- **缺**：
  - 欄位：**`show_on_media_wall`**（或 `show_on_homepage`）boolean，預設 false。
  - API：**「給媒體牆用的廠商對比圖列表」**（只回傳 `show_on_media_wall = true` 且建議有 `image_url_before` 的筆數，依 30% 比例取數）。
- **前端**：尚未在媒體牆顯示；要支援 1×1 小格 + 點開或 hover 時 Slider。

### 3. 系列產品資料夾（20%）— 需從零建

- **缺**：
  - 資料表：例如 **`media_collections`**（或 `homepage_collections`）  
    - 建議欄位：id, title, slug, cover_image_url, description, sort_order, is_active, created_at  
    - 若日後要「一個資料夾多張圖」可再補 `media_collection_items`。
  - API：**「給媒體牆用的資料夾列表」**（只回傳上架中的，依 20% 比例取數）。
  - 後台或管理介面：新增/編輯/排序/上下架（可後做，先用 SQL 或腳本塞資料）。
- **前端**：2×2 大格、點擊進資料夾頁或圖庫。

---

## 三、建議實作順序

### Step 1：資料層（你先做 SQL）

1. **廠商作品可上媒體牆**  
   - 在 Supabase SQL Editor 執行：

```sql
ALTER TABLE public.manufacturer_portfolio
ADD COLUMN IF NOT EXISTS show_on_media_wall BOOLEAN NOT NULL DEFAULT false;

COMMENT ON COLUMN public.manufacturer_portfolio.show_on_media_wall IS '是否在首頁媒體牆顯示（建議有 image_url_before 再做對比）';

CREATE INDEX IF NOT EXISTS idx_manufacturer_portfolio_show_on_media_wall
ON public.manufacturer_portfolio(show_on_media_wall) WHERE show_on_media_wall = true;
```

2. **系列產品資料夾表（新建）**  
   - 同一份或另開一個 query 執行：

```sql
CREATE TABLE IF NOT EXISTS public.media_collections (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    title text NOT NULL,
    slug text UNIQUE,
    cover_image_url text,
    description text,
    sort_order integer DEFAULT 0,
    is_active boolean NOT NULL DEFAULT true,
    created_at timestamptz DEFAULT now(),
    updated_at timestamptz DEFAULT now()
);

CREATE INDEX IF NOT EXISTS idx_media_collections_active ON public.media_collections(is_active) WHERE is_active = true;
COMMENT ON TABLE public.media_collections IS '媒體牆「系列產品資料夾」20%，首頁 2x2 大格';
```

- 若之後要「一資料夾多圖」再加 `media_collection_items` 即可，不影響第一步。

---

### Step 2：後端 API（我來改或你照規格接）

- **單一媒體牆 API**（建議）：  
  `GET /api/media-wall?page=1&per_page=20`  
  - 回傳「已混合、已按比例」的一維陣列，每筆帶 `type` 與格子大小，例如：
    - `type: 'user_design'`，`size: '1x1'`
    - `type: 'comparison'`，`size: '1x1'`，且帶 `image_url`、`image_url_before`（做 Slider）
    - `type: 'collection'`，`size: '2x2'`，帶 `title`、`cover_image_url`、`slug`
  - 比例：在 **per_page 格數** 內依 50% : 30% : 20% 計算各類型筆數（例如 20 格 → 10 / 6 / 4），再從三個來源分別取對應筆數，最後可做輕量隨機交錯（或固定交錯規則），讓版面自然。

- **或** 維持三個獨立 API，前端各叫一次再自己混比例與排序（較簡單但兩次請求、前端要算比例）。

- 廠商對比圖：需新 API 或擴充既有 `GET /api/manufacturer-portfolio`，例如加 query `for_media_wall=1`，只回傳 `show_on_media_wall = true` 且最好有 `image_url_before` 的項目。

- 資料夾：需新 API，例如 `GET /api/media-collections`（只回傳 `is_active = true`，依 `sort_order`/`created_at`）。

---

### Step 3：前端（首頁媒體牆）

- 改為呼叫 **一個** `GET /api/media-wall`（或三個 API 自行混比例）。
- 依每筆的 `type` + `size` 渲染：
  - **用戶設計**：1×1 小格，單圖，連結到客製產品/圖庫。
  - **廠商對比**：1×1 小格，Slider（概念圖 ⇄ 實品），連結到廠商或作品詳情。
  - **資料夾**：2×2 大格，封面圖 + 標題，連結到 `/custom/collection/:slug` 或圖庫篩選。
- 版面：同一瀑布流/網格裡隨機或規則交錯三種；資料夾用 CSS grid 或 class 佔 2×2（例如 `grid-column: span 2; grid-row: span 2`）。

---

## 四、你要先做的事（總結）

1. **執行兩段 SQL**（都在 Supabase SQL Editor）：  
   - 上面 **Step 1** 的 `manufacturer_portfolio.show_on_media_wall`。  
   - 上面 **Step 1** 的 `media_collections` 建表。  

2. **（可選）手動塞一筆資料夾**，方便之後對 API / 前端：  
   - 在 `media_collections` 插入一筆：`title`、`cover_image_url`（可先用手機圖或 placeholder）、`is_active = true`。  

3. **回覆我**：  
   - 「SQL 都跑完了」→ 我依這份規格接 **API（含比例 50:30:20 + 2x2）** 和 **首頁媒體牆前端**。  
   - 若你希望「先只做用戶設計 + 廠商對比，資料夾之後再加」，也可以說，我就先接兩類型與 50:30 比例，資料夾欄位保留。

---

## 五、比例與格數對照（方便實作）

| 每頁總格數 | 用戶設計圖 (50%) | 廠商對比 (30%) | 資料夾 (20%，2×2 大格) |
|------------|------------------|----------------|-------------------------|
| 20         | 10               | 6              | 4 格 = 2 張大卡         |
| 24         | 12               | 7              | 5 格 ≈ 2 張大卡 + 1 小  |
| 30         | 15               | 9              | 6 格 = 3 張大卡         |

實作時可在後端算好各類型筆數，再從三個來源分別 limit 取數、合併成一筆陣列回傳。
