# 產品設計 AI 與訂製品廠商搜尋 — 規劃

更新：2026-02-06

---

## 一、範圍摘要

| 項目 | 內容 |
|------|------|
| **產品設計 AI** | 多圖上傳 0~15 張、描述元素後由 AI 合成一張圖；利於設計程式與設計產品 AI。 |
| **設計介面** | **不強求一次到位**，支援設計後的再設計（迭代）；介面以**簡潔易用**為主。 |
| **訂製品廠商分類** | 改為偏設計向：服飾、運動用品、沙發家具等；參考網站少需補完；需後台管理編輯。 |
| **訂製品廠商作品圖** | 廠商可上傳**較多張**作品圖；**上限非硬性規定**，由營運／後台或設定決定（依儲存與成本訂合理值即可）。 |
| **訂製品廠商搜尋清單** | 不做深度媒合；設計圖符合之分類廠商皆可讓設計者瀏覽。 |

---

## 二、產品設計 AI（多圖合成）

### 2.1 現況

- **分析**：`POST /api/analyze-custom-product` 目前為 `upload.array('images', 10)`，最多 10 張。
- **流程**：上傳圖 + 選分類/數量/描述 → AI 分析多圖特點 → 回傳分析 JSON + 廠商列表；無「合成一張圖」步驟。
- **生成**：`POST /api/generate-product-image` 為單一 prompt 生成一張圖，未支援多圖 + 描述元素合成。

### 2.2 目標

- **多圖上傳**：支援多張參考圖（數量**非硬性規定**，是為方便使用者提供參考圖／輪廓圖進行設計；實際上限定例 0~15 張，可依 API／儲存成本由設定調整）。
- **描述元素**：使用者可填寫「要保留／結合的元素」文字（例如：A 圖的線條、B 圖的配色、C 圖的結構）。
- **合成一張圖**：AI 依多圖 + 元素描述，產出 **一張** 合成設計圖，供後續分析與廠商搜尋使用。
- **用途**：利於設計程式（如設計工具內嵌）與設計產品 AI 流程（概念 → 合成圖 → 找廠商）。

### 2.3 建議實作要點（規劃，不寫程式）

1. **API 調整**
   - 上傳上限由 10 改為 **15**（`upload.array('images', 15)` 或等同設定）。
   - 新增或擴充「合成」端點：輸入 = 多圖 + 元素描述（文字）；輸出 = 一張合成圖 URL（或 base64）。
   - 流程可為：**上傳多圖 + 描述元素 → 呼叫合成 API → 得到一張圖 → 再走現有分析 + 廠商搜尋**；或分析端點內建「先合成再分析」。
2. **前端**
   - 客製產品建立頁：支援 0~15 張上傳、元素描述欄位、可選「僅生成」或「生成後並分析」。
3. **儲存**
   - 合成圖建議存至 Supabase Storage（如 `custom-products/synthesized/`），並在 `custom_products` 留欄位（如 `synthesized_image_url` 或沿用 `ai_generated_image_url`）供後續分析與列表顯示。
4. **設計程式／設計產品 AI**
   - 文件或 API 說明中註明：多圖 + 元素描述 → 合成一張圖，適合設計軟體或設計產品 AI 串接。

### 2.4 設計介面原則（迭代 + 簡潔易用）

- **不強求一次到位**：設計圖允許「設計後的再設計」，不以一次生成完美為前提。
  - 流程上應支援：以**當前設計圖（或合成圖）為基礎**，再上傳、再改描述、再觸發合成／分析，形成迭代。
  - 例如：生成圖 A → 使用者不滿意 → 以圖 A 作為參考圖之一 + 新描述 → 再合成圖 B；或儲存為草稿後，從詳情頁「再設計」回到上傳／描述步驟。
- **簡潔易用為主**：
  - 介面不堆疊過多進階選項；主要動作為「上傳／描述 → 生成 → 滿意則下一步、不滿意則再設計」。
  - 文案與按鈕明確：例如「再設計」「以此圖為基礎修改」「儲存並找廠商」；避免同一頁過多分頁或巢狀表單。
  - 狀態清楚：區分「草稿／已生成／已分析／已儲存」，讓使用者知道可從哪一步繼續或重來。
- **實作時**：詳情頁或列表項提供「再設計」入口（帶入目前圖與分類），不覆蓋原紀錄時可存為新版本或新一筆，依產品策略決定。

---

## 三、訂製品廠商分類（設計向 + 後台）

### 3.1 現況

- 廠商表 `manufacturers` 有 **categories**（TEXT[]），目前示範資料多為 `furniture`、`interior`、`metalwork`、`art`、`textile`、`3d_printing`、`ceramic` 等。
- 服務媒合使用 `ai_categories` / `ai_subcategories`；訂製品若沿用或另建「訂製品專用分類」，需與廠商 `categories` 對齊。
- 後台目前有分類管理（`ai_categories`），**訂製品廠商分類**是否獨立一組、或共用主分類但子集合，需定案。

### 3.2 目標

- **分類取向**：訂製品廠商分類改為偏 **設計向**，例如：
  - 服飾（含訂製服、團體服、機能服等）
  - 運動用品（球具、護具、運動包等）
  - 沙發／家具（訂製沙發、系統家具、單品家具等）
  - 其他可再補：包袋、鞋類、家居織品、禮贈品等。
- **參考網站少**：目前可參考的現成網站較少，需**補完**分類與範例（可列在文件或後台說明，供營運填寫）。
- **後台管理**：訂製品廠商分類需支援 **管理後台編輯**（新增／修改／停用分類，與廠商 `categories` 對應）。

### 3.3 建議實作要點（規劃）

1. **資料來源**
   - 方案 A：沿用 `ai_categories`，新增一組「訂製品」主分類，其下子分類為服飾、運動用品、沙發家具等。
   - 方案 B：獨立「訂製品分類」表（如 `custom_product_categories`），key 與 `manufacturers.categories` 對齊，僅供訂製品流程與後台使用。
   - 建議先定一種，前後端與廠商查詢統一用同一組 key。
2. **種子／預設**
   - 建立「服飾、運動用品、沙發家具、…」等預設 key/名稱，並撰寫 SQL 或後台匯入，方便上線即有選項。
3. **後台**
   - 新增「訂製品廠商分類」管理頁（或整合至既有分類管理）：列表、新增、編輯、排序、停用；儲存後可供廠商勾選與搜尋篩選使用。
4. **廠商資料**
   - 廠商 `manufacturers.categories` 改為使用上述新 key（如 `apparel`、`sports_goods`、`sofa_furniture`）；後台編輯廠商時可多選這些分類。
5. **文件**
   - 在專案文件或後台說明中註明「參考網站較少，分類清單需營運補完」，並留欄位或列表供未來擴充。

---

## 四、訂製品廠商作品圖（多張上傳）

### 4.1 現況

- `manufacturers` 表目前**無**作品圖／作品集欄位，僅有基本資訊、分類、聯絡、能力等。
- 設計者瀏覽廠商時無法看到足夠作品範例。

### 4.2 目標

- 訂製品廠商可上傳**較多張**作品圖，供設計者參考；**張數上限非硬性規定**，依儲存與成本由營運／後台或設定訂合理值即可（避免過高造成成本負擔）。
- 後台管理廠商時可新增／編輯／刪除作品圖；前台（客製產品詳情、廠商列表）可展示作品圖。

### 4.3 建議實作要點（規劃）

1. **Schema**
   - 方案 A：新增 `manufacturer_portfolio` 表（`manufacturer_id`、`image_url`、`title`、`sort_order`、`created_at`），每廠商上限由設定或後台參數決定。
   - 方案 B：在 `manufacturers` 新增 JSONB 欄位如 `portfolio_images`，存 `[{ url, title?, sort_order? }]`，應用層依設定限制陣列長度。
2. **儲存**
   - 圖片上傳至 Supabase Storage（如 `manufacturer-portfolio/` 或 `custom-products/manufacturer/{id}/`），DB 存 URL。
3. **後台**
   - 廠商編輯頁：作品圖區塊，支援多檔上傳、排序、刪除，並顯示目前張數／**可設定的上限**（建議預設保守一點，之後可調高）。
4. **API**
   - 上傳：`POST /api/manufacturers/:id/portfolio` 或透過廠商更新 API 一併傳入 URL 陣列；若用獨立表則需批次寫入。
   - 查詢：取得廠商列表／單一廠商時一併回傳作品圖列表，供前台展示。
5. **前台**
   - 客製產品詳情頁「符合分類的廠商」卡片：可展示該廠商作品圖（如首圖或前幾張），點擊可展開更多。

實作時**上限建議可設定**（後台或 config），不寫死高張數，方便依成本調整。

---

## 五、訂製品廠商搜尋清單（分類符合即可瀏覽）

### 5.1 現況

- 分析後會呼叫 `queryManufacturers(category, analysis)`，目前實作會依 `category` 與 DB 欄位（如 `production_capabilities` / `categories`）查詢，並計算 `matchScore`，屬「深度媒合」邏輯。
- 前端：設計者在客製產品詳情頁看到「媒合廠商」列表。

### 5.2 目標

- **不需深度媒合**：訂製品廠商搜尋清單**不要求**複雜評分或深度媒合。
- **規則**：只要 **設計圖（或分析結果）符合的分類** 與廠商所屬分類一致，該廠商即列入清單，供設計者瀏覽。
- **行為**：設計者看到的是「符合此分類的所有廠商」清單，而非依分數排序的深度媒合結果；可選保留簡單排序（如依評分、地區），但不做多維度評分。

### 5.3 建議實作要點（規劃）

1. **API**
   - 提供「依分類取得廠商清單」：輸入 = 分類 key（來自設計圖／分析結果）；輸出 = 該分類下所有啟用廠商列表（可含基本欄位：名稱、地區、評分、聯絡方式等）。
   - 訂製品流程：分析後得到 `category`（或主分類 + 子分類）→ 呼叫「依分類取得廠商清單」→ 回傳列表給前端，**不計算 match_score**（或僅做選用：如依評分排序）。
2. **前端**
   - 客製產品詳情／搜尋結果頁：標題可改為「符合此分類的廠商」或「可瀏覽的訂製廠商」，列表展示所有符合分類的廠商，設計者自行瀏覽、聯繫。
3. **DB／後端對齊**
   - 廠商查詢條件與 2.2 對齊：使用 `manufacturers.categories` 含該分類 key、`is_active = true`（若 schema 為 `status` 則改為 `status = 'active'`）；確保與「訂製品廠商分類」同一組 key。
4. **與服務媒合區隔**
   - 文件註明：服務媒合（發包案）維持深度媒合（評分、篩選）；訂製品廠商清單為「分類符合即可瀏覽」，不混用邏輯。

---

## 六、待辦對照（供 matchdo-todo 使用）

| 序 | 項目 | 說明 |
|----|------|------|
| 1 | 產品設計 AI：多圖 0~15 張 + 元素描述 + 合成一張圖 | API 上限 15、新增/擴充合成步驟、前端上傳與描述、存合成圖；利於設計程式與設計產品 AI。**設計介面**：支援設計後再設計（迭代）、不強求一次到位；介面以簡潔易用為主（見 §2.4）。 |
| 2 | 訂製品廠商分類：設計向 + 後台 | 分類改為服飾、運動用品、沙發家具等；補完參考與種子；後台可編輯訂製品廠商分類。 |
| 3 | 訂製品廠商作品圖：多張上傳 | 每廠商可上傳較多作品圖；**上限非規定**，由營運/設定訂（依成本）；schema + 後台上傳與前台展示。 |
| 4 | 訂製品廠商搜尋：分類符合即可瀏覽 | 不做深度媒合；依設計圖/分析分類列出廠商清單，供設計者瀏覽。 |

實作時依此規劃分項開發，必要時再細化 API 規格與 DB 欄位。
