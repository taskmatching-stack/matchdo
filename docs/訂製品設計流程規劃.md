# 訂製品設計流程規劃

更新：2026-02-10  
**說明**：本文件僅規劃「設計流程」（使用者從發想到找廠商的步驟與決策點），不寫程式。技術實作與 API／分類／廠商搜尋等見 `docs/custom-product-design-and-manufacturer-search-plan.md`。

---

## 一、流程總覽

訂製品流程可簡化為四階段：

| 階段 | 名稱 | 使用者在做的事 | 系統產出 |
|------|------|----------------|----------|
| **1** | 發想與輸入 | 描述需求、上傳參考圖（或兩者皆有） | 草稿／可分析內容 |
| **2** | 生成或分析 | 選擇「僅生成圖」或「分析＋建議分類」 | 設計圖、分析結果（材料／難度／估價區間等） |
| **3** | 找廠商 | 依分析得到的分類瀏覽符合的訂製廠商 | 廠商清單（分類符合即可，不深度媒合） |
| **4** | 聯繫與後續 | 選擇廠商、發送聯繫、報價與成案 | 聯繫記錄、報價、狀態更新 |

流程設計原則：

- **不強求一次到位**：支援「再設計」迭代（以當前圖＋描述再生成／再分析）。
- **路徑可選**：可「只有文字」「只有圖」「多圖＋元素描述→合成一張圖」再進分析。
- **圖庫即參考圖**：參考圖除「本機上傳」外，可**從廠商作品圖庫載入**，不需另外上傳；客戶可直接用廠商作品當作再設計的起點。
- **純文字搜廠商圖再設計**：客戶可**僅輸入文字**（關鍵字／描述）→ **搜尋廠商作品圖** → 從結果選一張或多張加入參考圖 → 再設計。此路徑用「真實廠商作品」當起點，**可執行度較高**；且無 AI 生成／合成，**設計費或扣點可設較低**（或可不扣點），利於推廣。
- **狀態清楚**：草稿 → 已生成 → 已分析 → 已找廠商 → 已聯繫，讓使用者知道可從哪一步繼續。

---

## 二、入口與頁面對應

| 入口 | 說明 | 對應頁面／API |
|------|------|----------------|
| 首頁／導覽「客製產品」 | 建立一筆新的訂製需求 | `custom-product.html`（或 `/client` 下之建立頁） |
| **圖庫找廠商** | 瀏覽／搜尋廠商作品圖，從圖找廠商、聯繫或加入再設計 | 見下方 §十、獨立介面 |
| 我的客製產品 | 查看歷史、從某筆繼續或再設計 | `my-custom-products.html` |
| 產品詳情 | 查看單筆的圖、分析、廠商列表與聯繫 | `custom-product-detail.html?id=xxx` |

建議：**建立新訂製品**與**從詳情頁「再設計」**共用同一套輸入步驟（上傳／描述／生成／分析），差別在「再設計」可預填目前圖與分類，並可選擇存成新一筆或覆蓋原紀錄（依產品策略定案）。

---

## 三、階段一：發想與輸入

### 3.1 使用者可提供的內容

- **文字**：產品名稱、需求描述（材質、風格、尺寸、數量等）。
- **圖片**（來源可混用，總數上限依多圖規則如 0~15）：
  - **本機上傳**：單張示意圖／參考圖／手繪稿，或多張 ＋ 可選「元素描述」（例如：保留 A 圖線條、B 圖配色、C 圖結構），供後續「合成一張圖」使用。
  - **從廠商作品圖庫載入**：不須上傳，從平台上的廠商作品圖庫瀏覽、挑選一張或多張作為參考圖，加入當前設計／再設計的參考圖列表；等同「用廠商的作品再設計」。
  - **純文字搜廠商圖**：僅輸入文字（關鍵字／描述）→ 搜尋廠商作品圖 → 從結果選圖加入參考圖；不需上傳、也不耗 AI 生成，可執行度較高，設計費／扣點可調低。

### 3.2 決策點

- 若**只有文字**：
  - **純文字搜廠商圖再設計**（建議路徑）：輸入關鍵字／描述 → 搜尋廠商作品圖 → 從結果選圖加入參考圖 → 再設計（分析或合成後分析）。此路徑**可執行度較高**（真實作品）、**設計費／扣點可調低**。
  - 或走「僅生成圖」、或跳過生成直接選分類後找廠商（若未來支援純文字推分類）。
- 若**有圖（單張或多張）**：
  - 可選「僅分析」：不生成新圖，直接分析現有圖 → 得到分類與製作建議。
  - 可選「生成（或合成）後再分析」：多圖＋元素描述 → 合成一張圖 → 再分析該圖。

### 3.3 狀態與儲存

- **draft**：已填標題／描述／上傳圖，尚未執行「生成」或「分析」。
- 可在此階段儲存草稿，之後從「我的客製產品」或詳情頁繼續。

### 3.4 圖庫來源（廠商作品）

- **行為**：客戶在「發想與輸入」或「再設計」時，除上傳本機圖片外，可選擇**從圖庫載入**。
- **圖庫內容**：平台內廠商已上傳的作品圖（依訂製品廠商分類或廠商列表瀏覽）。
- **操作**：瀏覽廠商／廠商作品 → 勾選或點選要當作參考的圖片 → 加入當前設計的參考圖列表；**不需再上傳**，系統以該圖 URL 作為參考圖之一。
- **用途**：例如「看到某廠商作品很喜歡，想以此風格再設計」：直接從圖庫加入該張（或該廠商多張）作品，再填元素描述或直接分析／合成。

### 3.5 純文字搜廠商圖再設計（推薦路徑）

- **行為**：客戶**只輸入文字**（關鍵字、風格描述、品項名稱等）→ 系統**搜尋廠商作品圖**（依標籤／分類／標題或未來文字對圖搜尋）→ 回傳符合的廠商作品圖列表 → 客戶從結果中選一張或多張加入參考圖 → 進入「再設計」（可僅分析、或合成後分析）。全程**不需上傳圖、也不觸發 AI 生成圖**。
- **可執行度較高**：參考圖來自**真實廠商作品**，製作可行性與報價參考度較高，較易落地。
- **設計費／點數可調低**：此路徑沒有「AI 生成圖」或「AI 合成圖」，僅檢索與選用既有圖，成本較低；**設計費或扣點可設較低**（或此步驟不扣點），與「生成一張圖扣 20 點」等規則區隔，利於鼓勵使用。
- **介面**：建立頁或獨立入口提供「用文字搜廠商圖」；輸入框 ＋ 搜尋鈕 → 結果為廠商作品圖網格／列表 → 勾選「加入參考圖」→ 進入再設計流程。

### 3.6 介面要點（規劃）

- 表單簡潔：標題、描述、**上傳區 ＋「從圖庫選擇」＋「用文字搜廠商圖」**（單張或多張）、可選「元素描述」、分類預選（若已知）。
- 「從圖庫選擇」：提供入口（如按鈕「從廠商作品加入」），開啟圖庫瀏覽（可依分類／廠商篩選），選中的圖片加入參考圖列表，與本機上傳的圖片合併計算張數上限。
- **「用文字搜廠商圖」**：提供搜尋框與搜尋鈕，輸入關鍵字後回傳廠商作品圖結果，選中圖片可加入參考圖列表；可與「從圖庫選擇」共用同一參考圖列表與張數上限。
- 按鈕語意清楚：例如「儲存草稿」「僅生成設計圖」「分析並找廠商」「多圖合成一張再分析」；純文字路徑可強調「搜廠商圖再設計（省點數）」。
- 多圖時需標示張數上限（如 15 張）與元素描述為選填。

---

## 四、階段二：生成或分析

### 4.1 路徑 A：僅生成設計圖

- **輸入**：文字描述（＋ 可選單張參考圖）。
- **輸出**：一張 AI 生成圖，存成 `ai_generated_image_url`（或合成後存 `synthesized_image_url`）。
- **狀態**：仍可視為草稿或「已生成」，使用者可選擇「滿意則進入分析」或「再設計（迭代）」。

### 4.2 路徑 B：多圖 ＋ 元素描述 → 合成一張圖

- **輸入**：多張參考圖（0~15）＋ 元素描述文字。
- **輸出**：一張合成設計圖，存至 Storage，並寫入產品紀錄。
- **後續**：可再選「分析此圖並找廠商」，或「再設計」（以此圖為參考之一再合成）。

### 4.3 路徑 C：分析（現有圖或合成圖）

- **輸入**：目前產品紀錄上的圖（上傳圖／生成圖／合成圖）＋ 可選文字補充。
- **輸出**：
  - 分析結果 JSON：材料建議、複雜度、估價區間、製作時間、標籤等。
  - 建議分類（對應訂製品廠商分類 key），供階段三查廠商用。
- **狀態**：**analyzed** 或 **matched**（若分析後直接帶出廠商清單）。

### 4.4 迭代「再設計」

- 在詳情頁或列表提供「再設計」入口。
- 以**當前設計圖**（與可選分類）帶回「階段一」的輸入畫面，可：
  - 新增／更換參考圖（**本機上傳**或**從廠商作品圖庫載入**）、修改元素描述；
  - 再執行合成或生成；
  - 再分析。
- **用廠商作品再設計**：再設計時可直接從圖庫加入一或多張廠商作品當參考圖，不需下載再上傳。
- 存檔策略：可存成**新一筆**（保留原紀錄）或**覆蓋本筆**，由產品策略決定，規劃時預留選項即可。

### 4.5 介面要點（規劃）

- 生成／分析中顯示明確載入狀態；完成後顯示結果摘要與「找廠商」按鈕。
- 分析結果區塊：材料、難度、估價區間、建議分類，以易讀方式呈現。
- 提供「再設計」按鈕，文案如「以此圖為基礎修改」「再生成一次」。

---

## 五、階段三：找廠商

### 5.1 規則（與既有規劃一致）

- **分類符合即可瀏覽**：不做深度媒合；依分析得到的**分類 key** 查詢廠商，列出該分類下所有啟用廠商。
- 設計者看到的是「符合此分類的廠商」清單，可依評分、地區等做簡單排序，但不做多維度評分。

### 5.2 資料來源

- 分析結果中的分類 → 呼叫「依分類取得廠商清單」API。
- 廠商表 `manufacturers` 之 `categories` 含該 key、`is_active = true`。

### 5.3 介面要點（規劃）

- 標題可為「符合此分類的廠商」或「可接單的訂製廠商」。
- 列表展示：廠商名稱、地區、評分、能力標籤、作品圖（若已實作廠商作品圖）。
- 每筆提供「聯繫廠商」或「詢問報價」入口，進入階段四。

---

## 六、階段四：聯繫與後續

### 6.1 行為

- 設計者點選「聯繫廠商」→ 記錄聯繫意圖（可寫入 `custom_product_matches` 或聯繫紀錄表）。
- 若平台有站內訊息／Email 通知，可在此觸發；若為線下聯絡，則記錄「已聯繫」狀態供設計者自己追蹤。

### 6.2 狀態建議

- **contacted**：已對至少一家廠商發送聯繫。
- **quoted**：已收到報價（若廠商回填報價）。
- **accepted** / **rejected**：成案或婉拒（可選實作）。

### 6.3 介面要點（規劃）

- 詳情頁顯示「已聯繫廠商」列表與狀態。
- 可選：廠商回覆報價後，在詳情頁顯示報價金額與有效期限。

---

## 七、狀態流轉摘要

```
draft（草稿）
  → 僅生成圖 → 可視為 draft 或「已生成」
  → 分析     → analyzing → analyzed / matched（已分析／已列出廠商）

analyzed / matched
  → 聯繫廠商 → contacted
  → 收到報價 → quoted（可選）
  → 成案     → completed（可選）
```

- **再設計**：從任一「已有圖」的狀態可回到輸入步驟，再走生成／合成／分析，可存成新筆或覆蓋。
- 列表與詳情頁依狀態顯示不同操作（例如：草稿顯示「繼續編輯」、已分析顯示「找廠商」「再設計」）。

---

## 八、與現有／規劃功能對應

| 設計流程項目 | 對應現有／規劃 |
|--------------|----------------|
| 建立頁、上傳圖、描述 | `custom-product.html`、`POST /api/custom-products`、`POST /api/analyze-custom-product`（上傳最多 10→可擴 15） |
| 僅生成圖 | `POST /api/generate-product-image` |
| 多圖＋元素描述→合成一張圖 | 規劃中（見 `custom-product-design-and-manufacturer-search-plan.md` §二） |
| 分析→分類＋製作建議 | `POST /api/analyze-custom-product` 回傳 `analysis_json`、分類 |
| 依分類列廠商 | `GET /api/manufacturers?category=xxx`（分類符合即可，不深度媒合） |
| 聯繫廠商 | `POST /api/custom-products/:id/contact`、`custom_product_matches` |
| 我的客製產品、詳情頁 | `my-custom-products.html`、`custom-product-detail.html` |
| 再設計（迭代） | 規劃 §2.4 設計介面原則；詳情頁需「再設計」入口並帶入當前圖與分類 |
| **從廠商作品圖庫載入** | 參考圖除上傳外，可從廠商作品圖庫挑選加入（不需上傳）；需廠商作品圖 API／列表與建立頁／再設計頁之「從圖庫選擇」入口 |
| **純文字搜廠商圖再設計** | 輸入文字 → 搜尋廠商作品圖（標籤／分類／標題或文字對圖）→ 選圖加入參考 → 再設計；可執行度較高、設計費／扣點可調低；需搜尋 API 與「用文字搜廠商圖」入口 |
| **圖庫找廠商介面** | 獨立頁「圖庫找廠商」：瀏覽／搜尋廠商作品圖、點圖看廠商／聯繫／加入再設計；見 §十 |
| 訂製品廠商分類、作品圖 | 見 `custom-product-design-and-manufacturer-search-plan.md` §三、§四 |

---

## 九、建議實作順序（供排程用）

1. **流程可走通**：確保「輸入 → 分析 → 依分類看廠商 → 聯繫」一條龍可完成（廠商搜尋改為分類符合即可）。
2. **再設計**：詳情頁加「再設計」、帶回建立／編輯步驟，可存新筆或覆蓋。
3. **從廠商作品圖庫載入**：建立頁／再設計頁提供「從圖庫選擇」；圖庫來源為廠商作品圖，客戶可選一張或多張加入參考圖、不需上傳（需先有廠商作品圖 API／資料，見下項）。
4. **純文字搜廠商圖再設計**：提供「用文字搜廠商圖」入口；輸入關鍵字→搜尋廠商作品圖→選圖加入參考→再設計。此路徑可執行度較高、設計費／扣點可設較低（或此步不扣點）；需廠商作品圖含標籤／標題等可供搜尋、或未來文字對圖搜尋 API。
5. **多圖合成**：多圖上傳＋元素描述→合成一張圖→再分析（依 API 與成本規劃）。
6. **廠商分類與作品圖**：訂製品廠商分類設計向＋後台、廠商作品圖多張上傳與展示（圖庫載入與文字搜圖依賴此項）。
7. **圖庫找廠商介面**：獨立頁「圖庫找廠商」，見 §十。

以上為訂製品設計流程之規劃，實作時可依此對應到畫面與 API，並與 `docs/custom-product-design-and-manufacturer-search-plan.md` 一併使用。

---

## 十、圖庫找廠商的獨立介面

### 10.1 定位

- **目的**：以「廠商作品圖」為入口，讓客戶**從圖庫找廠商**——瀏覽或搜尋作品圖，點圖看所屬廠商、聯繫或將圖加入再設計。
- **與訂製品流程關係**：可作為「建立訂製品」的起點（純文字搜廠商圖、從圖庫選圖），也可作為**只蒐廠商、暫不發案**的瀏覽入口。

### 10.2 介面要點（規劃）

- **單一入口**：導覽列或首頁提供「圖庫找廠商」（或「廠商作品圖庫」），進入**獨立頁面**。
- **瀏覽與搜尋**：
  - **分類篩選**：依訂製品廠商分類（服飾、沙發家具、運動用品等）篩選作品。
  - **文字搜尋**：關鍵字搜尋廠商作品圖（標題、標籤、廠商名稱）。
  - **結果呈現**：以**圖牆／網格**為主，每張圖可顯示所屬廠商名稱、分類；點圖進入「該圖詳情」或「該廠商頁」。
- **單張圖的後續動作**：
  - **看廠商**：進入廠商介紹頁（聯絡方式、其他作品、能力標籤）。
  - **聯繫廠商**：直接發送聯繫／詢問報價。
  - **加入再設計**：將此圖加入「參考圖」並跳轉至訂製品建立／再設計流程（不需上傳）。
- **與建立頁的整合**：建立訂製品頁的「從圖庫選擇」「用文字搜廠商圖」可**共用同一套圖庫資料與搜尋 API**，必要時可從「圖庫找廠商」頁選圖後帶參數跳轉至建立頁並預填參考圖。

### 10.3 技術對應（規劃）

- 需**廠商作品圖 API**（列表、依分類／關鍵字篩選）、單張作品與所屬廠商資訊。
- 獨立路由／頁面：例如 `/client/gallery.html` 或 `/browse-manufacturer-gallery`（依現有路由風格定名）。

---

## 十一、金流支援評估（以蒐廠商為主，是否開放線上付款）

### 11.1 產品定位前提

- 本站**以蒐廠商、媒合與聯繫為主**，不必然以「線上直購」為核心；若廠商有線上收款需求，是否由平台支援金流需單獨評估。

### 11.2 是否支援平台內線上付款：評估摘要

| 面向 | 說明 |
|------|------|
| **支援的優點** | 廠商可接單即收款，減少線下對帳與信任成本；部分客戶習慣線上付款；平台可依成交抽成或手續費變現（若策略允許）。 |
| **不支援／延後支援的優點** | 開發與合規成本低（金流、發票、爭議處理）；平台專注「找廠商、聯繫、報價」流程，不涉入交易與資金；廠商可自行用 LINE Pay、轉帳、其他電商等收款，平台不承擔金流責任。 |
| **風險與成本** | 若平台收付款：需金流串接、可能需電子發票、爭議與退款處理、法規（電子支付／第三方支付）與合約；若僅提供「連結到廠商自己的收款頁」則責任較小。 |

### 11.3 建議（供決策）

- **第一階段（以蒐廠商為主）**：**不納入平台內線上直購金流**。  
  - 維持「找廠商 → 聯繫 → 報價／議價 → 線下或廠商自有管道成交」；若廠商需要線上收款，可於廠商介紹／聯絡區**開放欄位填寫「廠商自有付款連結」**（如綠界、LINE Pay、自架賣場），由客戶自行前往付款，平台不經手款項。
- **若未來要開放平台內金流**：  
  - 可評估：**僅提供「連結至廠商指定收款頁」**（平台不經手錢），或  
  - **由平台代收再撥款給廠商**（需金流串接、合約、抽成與合規）；後者建議在「蒐廠商」與媒合量穩定、且營運有明確變現需求時再評估。
- **實作建議**：  
  - 廠商資料表預留**「付款連結」或「收款方式說明」**欄位（文字／URL），供廠商填寫自家賣場或金流連結；  
  - 前台廠商卡／廠商頁可顯示「付款方式」或「前往付款」連結（連到廠商指定 URL），**不實作平台內下單與扣款**，即可兼顧廠商需求與平台現階段定位。

### 11.4 以「輔導廠商自架賣場」為規劃方向（與主站性質區分）

- **主站定位**：**蒐廠商、媒合、聯繫**為主；不經手金流、不代收代付，維持平台「找廠商、看作品、詢價、聯繫」的性質。
- **輔導自架賣場**：若廠商有線上收款需求，可規劃為**協助輔導廠商自架賣場**（或串接既有開店／金流工具），由廠商在自己賣場收款，主站僅提供：
  - **資源與指引**：例如「如何自架賣場」「推薦開店／金流工具」說明頁、懶人包或連結。
  - **廠商後台欄位**：填寫**自架賣場連結**（官網、Shopline、蝦皮、LINE 商店等），前台顯示「前往廠商賣場」。
  - **可選**：日後若營運有資源，可提供**輔導服務**（教學、建議方案、合作工具介紹），以**加值服務**形式與主站區隔，而非把「下單與金流」做進主站。
- **區分清楚的好處**：主站 = 媒合與發現廠商；收款與交易 = 廠商自有賣場。平台不涉入資金與爭議，性質單一、合規與開發負擔小，且「輔導自架賣場」可單獨定價或作為廠商進階服務，與主站免費／訂閱模式區隔。
